<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<title>Authentication</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(180deg,#05070f,#0a0f24);
  color:#fff;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.card{
  width:92%;
  max-width:390px;
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.25);
  backdrop-filter:blur(18px);
  border-radius:22px;
  padding:20px;
}

h2{text-align:center;margin:6px 0 14px}

input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:12px;
  border:none;
  outline:none;
  font-size:14px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:15px;
  font-weight:900;
  background:linear-gradient(135deg,#ffd36e,#ffb700);
  color:#000;
  margin-top:6px;
  cursor:pointer;
}

.link{
  text-align:center;
  margin-top:10px;
  font-size:13px;
  opacity:.85;
  cursor:pointer;
}

.hidden{display:none}
</style>
</head>

<body>

<div class="card">

  <!-- REGISTER -->
  <div id="registerBox">
    <h2>Create Account</h2>

    <input id="fullName" placeholder="Full name">
    <input id="country" placeholder="Country">
    <input id="address" placeholder="Address">
    <input id="emailR" type="email" placeholder="Email">
    <input id="passwordR" type="password" placeholder="Password">
    <input id="passwordR2" type="password" placeholder="Confirm password">
    <input id="referral" placeholder="Referral code (optional)">

    <button id="registerBtn">Register</button>

    <div class="link" onclick="showLogin()">Already have an account? Login</div>
  </div>

  <!-- LOGIN -->
  <div id="loginBox" class="hidden">
    <h2>Login</h2>

    <input id="emailL" type="email" placeholder="Email">
    <input id="passwordL" type="password" placeholder="Password">

    <button id="loginBtn">Login</button>

    <div class="link" onclick="showReset()">Forgot password?</div>
    <div class="link" onclick="showRegister()">Create new account</div>
  </div>

  <!-- RESET PASSWORD -->
  <div id="resetBox" class="hidden">
    <h2>Reset Password</h2>

    <input id="emailReset" type="email" placeholder="Enter your email">

    <button id="resetBtn">Send Reset Link</button>

    <div class="link" onclick="showLogin()">Back to login</div>
  </div>

</div>

<script type="module" defer>
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyA1HZLZRY9UADNnDVBnoBIlG3b-bCkojxs",
  authDomain: "primeinvestproject2.firebaseapp.com",
  projectId: "primeinvestproject2",
  storageBucket: "primeinvestproject2.firebasestorage.app",
  messagingSenderId: "798977477628",
  appId: "1:1:798977477628:web:c97d1fba72ad7865864079"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* UI SWITCHES */
window.showLogin = ()=>{
  hideAll(); document.getElementById("loginBox").classList.remove("hidden");
};
window.showRegister = ()=>{
  hideAll(); document.getElementById("registerBox").classList.remove("hidden");
};
window.showReset = ()=>{
  hideAll(); document.getElementById("resetBox").classList.remove("hidden");
};
function hideAll(){
  document.querySelectorAll(".card > div").forEach(d=>d.classList.add("hidden"));
}

/* REGISTER */
document.getElementById("registerBtn").onclick = async ()=>{
  const fullName = document.getElementById("fullName").value.trim();
  const country = document.getElementById("country").value.trim();
  const address = document.getElementById("address").value.trim();
  const email = document.getElementById("emailR").value.trim();
  const pass1 = document.getElementById("passwordR").value;
  const pass2 = document.getElementById("passwordR2").value;
  const referral = document.getElementById("referral").value.trim();

  if(!fullName || !country || !address || !email || !pass1){
    alert("Fill all required fields");
    return;
  }
  if(pass1 !== pass2){
    alert("Passwords do not match");
    return;
  }

  try{
    const cred = await createUserWithEmailAndPassword(auth,email,pass1);

    await setDoc(doc(db,"users",cred.user.uid),{
      fullName,
      country,
      address,
      email,
      referralCode: referral || null,
      score:0,
      tapsToday:0,
      tapsDate:"",
      createdAt: serverTimestamp()
    });

    alert("Account created");
    location.href = "index.html";
  }catch(e){
    alert(e.message);
  }
};

/* LOGIN */
document.getElementById("loginBtn").onclick = async ()=>{
  try{
    await signInWithEmailAndPassword(
      auth,
      document.getElementById("emailL").value,
      document.getElementById("passwordL").value
    );
    location.href = "index.html";
  }catch(e){
    alert("Login failed");
  }
};

/* RESET PASSWORD */
document.getElementById("resetBtn").onclick = async ()=>{
  const email = document.getElementById("emailReset").value.trim();
  if(!email){
    alert("Enter your email");
    return;
  }
  try{
    await sendPasswordResetEmail(auth,email);
    alert("Password reset email sent");
    showLogin();
  }catch(e){
    alert("Failed to send reset email");
  }
};
</script>

</body>
</html>
