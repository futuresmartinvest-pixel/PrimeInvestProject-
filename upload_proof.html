<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Deposit Proof</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: system-ui, sans-serif;
  background:#f5f5f5;
}

.header{
  background:#b7ff2c;
  padding:20px;
  font-size:22px;
  font-weight:700;
}

.container{
  padding:16px;
}

.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

input[type=file]{
  width:100%;
  margin-top:10px;
}

button{
  margin-top:15px;
  width:100%;
  padding:14px;
  font-size:16px;
  border:none;
  border-radius:12px;
  background:#000;
  color:#fff;
}
</style>
</head>

<body>

<div class="header">Upload Deposit Proof</div>

<div class="container">
  <div class="card">
    <p><strong>VIP:</strong> <span id="vipName"></span></p>
    <p><strong>Amount:</strong> $<span id="vipPrice"></span></p>

    <input type="file" id="imageInput" accept="image/*">

    <button id="submitBtn">Submit Proof</button>
  </div>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import {
  getStorage,
  ref,
  uploadBytes,
  getDownloadURL
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

import {
  collection,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const storage = getStorage();

// Read URL params
const params = new URLSearchParams(window.location.search);
const vipId = params.get("vip");
const price = params.get("price");

document.getElementById("vipName").innerText = vipId;
document.getElementById("vipPrice").innerText = price;

document.getElementById("submitBtn").onclick = async () => {
  const user = auth.currentUser;
  if(!user){ alert("Please login"); return; }

  const file = document.getElementById("imageInput").files[0];
  if(!file){ alert("Please select an image"); return; }

  try{
    // Upload image
    const imgRef = ref(storage, `vip_proofs/${user.uid}/${vipId}_${Date.now()}`);
    await uploadBytes(imgRef, file);
    const imageUrl = await getDownloadURL(imgRef);

    // Save request
    await addDoc(collection(db, "vipRequests"), {
      userId: user.uid,
      vipId: vipId,
      amount: Number(price),
      imageUrl: imageUrl,
      status: "pending",
      createdAt: serverTimestamp()
    });

    alert("Deposit proof submitted. Waiting for admin approval.");
    location.href = "index.html";

  } catch(err){
    alert("Upload failed: " + err.message);
  }
};
</script>

</body>
</html>
