<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>PrimeGlobalPro</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  color:#fff;
  background:
    radial-gradient(circle at 20% 20%, #7f5cff55, transparent 40%),
    radial-gradient(circle at 80% 70%, #00e5ff55, transparent 40%),
    linear-gradient(180deg,#05070f,#0a0f24);
}
.wrap{max-width:420px;margin:auto;padding:16px 16px 90px}
.glass{
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(18px);
  border-radius:24px;
  padding:18px;
}
.balance{text-align:center}
.amount{font-size:48px;font-weight:900}
.vip{opacity:.8;margin-top:6px}
.tap{
  width:260px;height:260px;margin:20px auto;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:900;font-size:18px;
  border:1px solid rgba(255,255,255,.3);
}
.stats{margin-top:16px}
.row{display:flex;justify-content:space-between;margin-bottom:8px;font-weight:700}

.menu{position:absolute;top:12px;right:12px}
.menu button{background:none;border:none;color:#fff;font-size:22px}
.menuBox{
  display:none;
  background:#000c;
  border-radius:12px;
  padding:8px;
  position:absolute;right:0;top:28px
}
.menuBox button{
  background:none;border:none;color:#fff;
  padding:10px;width:100%;text-align:left
}
</style>
</head>

<body>

<div class="menu">
  <button onclick="toggleMenu()">⋮</button>
  <div class="menuBox" id="menuBox">
    <button onclick="changePassword()">Change password</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="wrap">

  <div class="glass balance">
    <div class="amount" id="balance">$0.00</div>
    <div class="vip" id="vip">VIP: None</div>
  </div>

  <div class="tap" id="tapBtn">TAP</div>

  <div class="glass stats">
    <div class="row"><span>Score</span><span id="score">0</span></div>
    <div class="row"><span>Tap power</span><span id="power">1×</span></div>
    <div class="row"><span>Today taps</span><span id="today">0 / 500000</span></div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, runTransaction, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1HZLZRY9UADNnDVBnoBIlG3b-bCkojxs",
  authDomain: "primeinvestproject2.firebaseapp.com",
  projectId: "primeinvestproject2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const SCORE_PER_USD = 10000000;
const DAILY_LIMIT = 500000;
const MULT = {0:1,1:5,2:10,3:20,4:40,5:80,6:800,7:8000,8:80000};

let userRef;

onAuthStateChanged(auth, async user=>{
  if(!user){ location.replace("auth.html"); return; }
  userRef = doc(db,"users",user.uid);
  await ensureUser();
  refresh();
});

async function ensureUser(){
  const snap = await getDoc(userRef);
  if(!snap.exists()){
    await runTransaction(db, tx=>{
      tx.set(userRef,{
        score:0,
        tapsToday:0,
        tapsDate:new Date().toDateString(),
        balance:0,
        createdAt:serverTimestamp()
      });
    });
  }
}

function today(){ return new Date().toDateString(); }

async function refresh(){
  const snap = await getDoc(userRef);
  const u = snap.data();
  const vipLevel = u.vip?.level || 0;
  const power = MULT[vipLevel] || 1;
  const score = u.score || 0;
  const usd = score / SCORE_PER_USD;

  document.getElementById("vip").textContent = vipLevel ? `VIP: ${vipLevel}` : "VIP: None";
  document.getElementById("power").textContent = power+"×";
  document.getElementById("score").textContent = score;
  document.getElementById("balance").textContent = "$"+usd.toFixed(2);
  document.getElementById("today").textContent =
    `${u.tapsToday || 0} / ${vipLevel ? "∞" : DAILY_LIMIT}`;
}

document.getElementById("tapBtn").onclick = async ()=>{
  try{
    await runTransaction(db, async tx=>{
      const snap = await tx.get(userRef);
      const u = snap.data();
      const vip = u.vip?.level || 0;
      const power = MULT[vip] || 1;
      let taps = u.tapsToday || 0;
      let date = u.tapsDate || today();

      if(date !== today()){ taps=0; date=today(); }
      if(vip===0 && taps>=DAILY_LIMIT) throw "Daily limit";

      tx.update(userRef,{
        score:(u.score||0)+power,
        tapsToday:taps+1,
        tapsDate:date
      });
    });
    refresh();
  }catch(e){ alert(e); }
};

window.toggleMenu=()=>menuBox.style.display=menuBox.style.display?"":"block";
window.logout=async()=>{ await signOut(auth); location.replace("auth.html"); };
window.changePassword=async()=>{
  await sendPasswordResetEmail(auth, auth.currentUser.email);
  alert("Password reset email sent");
};
</script>

</body>
</html>
