<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>PrimeGlobalPro</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:#fff;
  height:100vh;
  overflow:auto;
}

/* ===== BALANCE ===== */
.balance{
  text-align:center;
  margin-top:18px;
  font-size:32px;
  font-weight:800;
}

/* ===== TAP BOT ===== */
.tap-area{
  margin:40px auto;
  width:220px;
  height:220px;
  border-radius:50%;
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(14px);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:72px;
  cursor:pointer;
  user-select:none;
  box-shadow:0 20px 50px rgba(0,0,0,.5);
}
.tap-area:active{
  transform:scale(0.96);
}

/* ===== INFO ===== */
.info{
  text-align:center;
  font-size:14px;
  opacity:.8;
}

/* ===== BOTTOM NAV ===== */
.nav{
  position:fixed;
  bottom:16px;
  left:16px;
  right:16px;
  background:rgba(255,255,255,0.9);
  backdrop-filter:blur(16px);
  border-radius:26px;
  display:flex;
  justify-content:space-around;
  padding:14px 0;
  color:#000;
}
.nav div{
  font-size:22px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="balance">$0.00</div>

<div class="tap-area" id="tap">ü§ñ</div>

<div class="info">
  Daily taps used: <span id="used">0</span>
</div>

<div class="nav">
  <div>üè†</div>
  <div onclick="location.href='tasks.html'">üìã</div>
  <div onclick="location.href='wallet.html'">üëõ</div>
  <div onclick="location.href='referral.html'">üë•</div>
  <div onclick="location.href='deposit.html'">üëë</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  setDoc,
  updateDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyA1HZLZRY9UADNnDVBnoBIlG3b-bCkojxs",
  authDomain: "primeinvestproject2.firebaseapp.com",
  projectId: "primeinvestproject2",
  storageBucket: "primeinvestproject2.firebasestorage.app",
  messagingSenderId: "798977477628",
  appId: "1:798977477628:web:c97d1fba72ad7865864079"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== VIP MULTIPLIERS ===== */
const MULTI = {
  0:1,
  1:5,
  2:10,
  3:20,
  4:40,
  5:80,
  6:800,
  7:8000,
  8:80000
};

const DAILY_LIMIT = 500000;
const POINTS_PER_DOLLAR = 10000000;

/* ===== USER ID ===== */
function uid(){
  let u = localStorage.getItem("userId");
  if(!u){
    u = "user_"+Date.now()+"_"+Math.random().toString(36).slice(2,8);
    localStorage.setItem("userId",u);
  }
  return u;
}

const userId = uid();
const ref = doc(db,"users",userId);

/* ===== INIT USER ===== */
async function init(){
  const snap = await getDoc(ref);
  if(!snap.exists()){
    await setDoc(ref,{
      balance:0,
      tapsToday:0,
      lastTapDay:new Date().toDateString(),
      createdAt:serverTimestamp()
    });
  }
}
await init();

/* ===== TAP LOGIC ===== */
const tapBtn = document.getElementById("tap");
const balanceEl = document.querySelector(".balance");
const usedEl = document.getElementById("used");

tapBtn.onclick = async ()=>{
  const snap = await getDoc(ref);
  if(!snap.exists()) return;
  let d = snap.data();

  const today = new Date().toDateString();
  if(d.lastTapDay !== today){
    d.tapsToday = 0;
    d.lastTapDay = today;
  }

  const vipLevel = d.vip?.level || 0;
  const multi = MULTI[vipLevel] || 1;

  if(vipLevel === 0 && d.tapsToday >= DAILY_LIMIT){
    alert("Daily limit reached");
    return;
  }

  const points = multi;
  const dollars = points / POINTS_PER_DOLLAR;

  await updateDoc(ref,{
    tapsToday:d.tapsToday+1,
    lastTapDay:today,
    balance:(d.balance||0)+dollars
  });

  balanceEl.textContent="$"+((d.balance||0)+dollars).toFixed(6);
  usedEl.textContent=d.tapsToday+1;
};

/* ===== LOAD UI ===== */
async function refresh(){
  const snap = await getDoc(ref);
  if(!snap.exists()) return;
  balanceEl.textContent="$"+(snap.data().balance||0).toFixed(6);
  usedEl.textContent=snap.data().tapsToday||0;
}
refresh();
</script>

</body>
</html>
