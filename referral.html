<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>Referral Program</title>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  min-height:100vh;
  background:
    radial-gradient(circle at 20% 20%, #7f5cff55, transparent 40%),
    radial-gradient(circle at 80% 70%, #00e5ff55, transparent 40%),
    linear-gradient(180deg,#05070f,#0a0f24);
  color:#fff;
}

/* GLASS */
.glass{
  background:rgba(255,255,255,0.12);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  border:1px solid rgba(255,255,255,0.25);
  border-radius:22px;
  box-shadow:0 0 25px rgba(120,200,255,0.35);
}

/* HEADER */
h1{
  text-align:center;
  margin:20px 0 16px;
  font-weight:800;
}

/* CONTAINER */
.container{
  max-width:420px;
  margin:auto;
  padding:16px;
}

/* BLOCK */
.block{
  padding:18px;
  margin-bottom:16px;
}

.label{
  font-size:14px;
  opacity:.8;
  margin-bottom:6px;
}

.value{
  font-size:18px;
  font-weight:700;
  word-break:break-all;
}

/* INPUT LOOK */
.fake-input{
  background:rgba(0,0,0,.35);
  padding:12px;
  border-radius:14px;
  margin-top:6px;
}

/* BUTTON */
button{
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:16px;
  font-weight:900;
  font-size:16px;
  background:linear-gradient(135deg,#ffd36e,#ffb700);
  color:#000;
  cursor:pointer;
}

/* STATS */
.stats{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:10px;
}

.stat{
  padding:14px;
  text-align:center;
}

.stat b{
  display:block;
  font-size:22px;
  margin-top:4px;
}

.back{
  text-align:center;
  margin-top:16px;
  opacity:.7;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>Referral Program</h1>

<div class="container">

  <div class="glass block">
    <div class="label">Your Referral Code</div>
    <div class="fake-input value" id="refCode">Loading...</div>

    <div class="label" style="margin-top:14px">Your Referral Link</div>
    <div class="fake-input value" id="refLink">Loading...</div>

    <button onclick="copyLink()">COPY LINK</button>
  </div>

  <div class="glass block">
    <div class="label">Your Stats</div>
    <div class="stats">
      <div class="glass stat">
        Referred
        <b id="refCount">0</b>
      </div>
      <div class="glass stat">
        Earnings
        <b id="refEarning">$0.00</b>
      </div>
    </div>
  </div>

  <div class="back" onclick="location.href='index.html'">
    ‚Üê Back to Home
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyA1HZLZRY9UADNnDVBnoBIlG3b-bCkojxs",
  authDomain: "primeinvestproject2.firebaseapp.com",
  projectId: "primeinvestproject2",
  storageBucket: "primeinvestproject2.firebasestorage.app",
  messagingSenderId: "798977477628",
  appId: "1:798977477628:web:c97d1fba72ad7865864079"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* USER ID */
function uid(){
  let id = localStorage.getItem("userId");
  if(!id){
    id = "user_"+Date.now()+"_"+Math.random().toString(36).slice(2,8);
    localStorage.setItem("userId",id);
  }
  return id;
}

const userRef = doc(db,"users",uid());

async function load(){
  const snap = await getDoc(userRef);

  if(!snap.exists()){
    await setDoc(userRef,{
      referralCode: uid().slice(-6).toUpperCase(),
      referred:0,
      referralEarning:0,
      createdAt:serverTimestamp()
    });
  }

  const data = (await getDoc(userRef)).data();

  const code = data.referralCode;
  const link = location.origin + "/index.html?ref=" + code;

  document.getElementById("refCode").innerText = code;
  document.getElementById("refLink").innerText = link;
  document.getElementById("refCount").innerText = data.referred || 0;
  document.getElementById("refEarning").innerText =
    "$"+Number(data.referralEarning||0).toFixed(2);
}

window.copyLink = ()=>{
  navigator.clipboard.writeText(document.getElementById("refLink").innerText);
  alert("Referral link copied");
};

load();
</script>

</body>
</html>
